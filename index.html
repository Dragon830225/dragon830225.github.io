<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Außer Haus Lieferung mit Firebase</title>
<style>
  /* Dein CSS hier (kannst du vom vorherigen Beispiel übernehmen) */
  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
  h1 { text-align: center; }
  #loginDiv, #adminDiv, #fahrerDiv { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
  label, input, button { font-size: 1.1em; margin: 5px 0; }
  input[type="text"] { width: 100%; padding: 6px; }
  button { padding: 10px 15px; cursor: pointer; }
  .hidden { display: none; }
  #kundenListe { margin-top: 10px; border: 1px solid #ccc; padding: 10px; min-height: 150px; background: #fafafa; }
  .kunde { padding: 8px; border: 1px solid #ddd; margin-bottom: 5px; background: #fff; cursor: grab; }
  .kunde.dragging { opacity: 0.5; }
  #menuForm textarea { width: 100%; height: 100px; font-size: 1em; }
  #menuFahrer { white-space: pre-line; background: #e8e8e8; padding: 10px; margin-top: 10px; }
  #map { height: 300px; margin-top: 15px; border: 1px solid #ccc; }
  .kundenfelder { display: flex; gap: 10px; }
  .kundenfelder input { flex: 1; }
</style>
</head>
<body>

<h1>Außer Haus Lieferung (Firebase)</h1>

<div id="loginDiv">
  <label for="passwort">Admin Passwort eingeben:</label>
  <input type="password" id="passwort" />
  <button id="loginBtn">Login</button>
  <p id="loginFehler" style="color:red;"></p>
</div>

<div id="adminDiv" class="hidden">
  <h2>Adminbereich</h2>
  <button id="logoutBtn">Logout</button>

  <h3>Kunden verwalten (Drag & Drop zum Sortieren)</h3>
  <div id="kundenListe"></div>
  <button id="kundeNeuBtn">Neuen Kunden hinzufügen</button>

  <h3>Menü für die Woche eingeben</h3>
  <form id="menuForm">
    <textarea id="menuText" placeholder="Menü für die Woche hier eingeben, z.B.:\nMontag: ...\nDienstag: ..."></textarea><br />
    <button type="submit">Menü speichern</button>
  </form>

  <h3>Kunden auf Karte</h3>
  <div id="map"></div>
</div>

<div id="fahrerDiv" class="hidden">
  <h2>Fahrer Ansicht</h2>
  <p>Menü für heute:</p>
  <div id="menuFahrer"></div>
  <h3>Kundenliste</h3>
  <div id="kundenFahrerListe"></div>
  <div id="map"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=DEIN_GOOGLE_MAPS_API_KEY"></script>

<script>
// --- Firebase konfigurieren ---
const firebaseConfig = {
  apiKey: "AIzaSyAJcjqAjlyrbiojweyXFOLMrelTsHSFog0",
  authDomain: "ausser-haus.firebaseapp.com",
  databaseURL: "https://ausser-haus-default-rtdb.firebaseio.com",
  projectId: "ausser-haus",
  storageBucket: "ausser-haus.appspot.com",
  messagingSenderId: "919348966579",
  appId: "1:919348966579:web:8cdbe342868eb6013eecc6"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const adminPasswort = "1234";

const loginDiv = document.getElementById("loginDiv");
const adminDiv = document.getElementById("adminDiv");
const fahrerDiv = document.getElementById("fahrerDiv");

const passwortInput = document.getElementById("passwort");
const loginBtn = document.getElementById("loginBtn");
const loginFehler = document.getElementById("loginFehler");

const logoutBtn = document.getElementById("logoutBtn");

const kundenListe = document.getElementById("kundenListe");
const kundeNeuBtn = document.getElementById("kundeNeuBtn");

const menuForm = document.getElementById("menuForm");
const menuTextArea = document.getElementById("menuText");

const menuFahrer = document.getElementById("menuFahrer");
const kundenFahrerListe = document.getElementById("kundenFahrerListe");

let kunden = [];
let menuText = "";

// Kunden rendern (Admin)
function renderKunden() {
  kundenListe.innerHTML = "";
  kunden.forEach((kunde, index) => {
    const div = document.createElement("div");
    div.className = "kunde";
    div.draggable = true;
    div.dataset.index = index;
    div.innerHTML = `
      <div class="kundenfelder">
        <input type="text" class="name" placeholder="Name" value="${kunde.name}" />
        <input type="text" class="strasse" placeholder="Straße" value="${kunde.strasse}" />
        <input type="text" class="ort" placeholder="Ort" value="${kunde.ort}" />
      </div>
      <button class="kundeLoeschen">Löschen</button>
    `;
    kundenListe.appendChild(div);

    div.querySelector(".kundeLoeschen").addEventListener("click", () => {
      kunden.splice(index, 1);
      saveKunden();
    });

    ["name", "strasse", "ort"].forEach(field => {
      div.querySelector(`.${field}`).addEventListener("input", e => {
        kunden[index][field] = e.target.value;
        saveKunden();
      });
    });

    // Drag & Drop Events
    div.addEventListener("dragstart", e => {
      e.dataTransfer.effectAllowed = "move";
      e.dataTransfer.setData("text/plain", index);
      div.classList.add("dragging");
    });
    div.addEventListener("dragend", () => {
      div.classList.remove("dragging");
    });
    div.addEventListener("dragover", e => {
      e.preventDefault();
    });
    div.addEventListener("drop", e => {
      e.preventDefault();
      const srcIndex = e.dataTransfer.getData("text/plain");
      const tgtIndex = index;
      if (srcIndex !== tgtIndex) {
        const moved = kunden.splice(srcIndex, 1)[0];
        kunden.splice(tgtIndex, 0, moved);
        saveKunden();
      }
    });
  });
}

// Kundenliste für Fahrer rendern (nur lesen)
function renderFahrer() {
  kundenFahrerListe.innerHTML = "";
  kunden.forEach(kunde => {
    const div = document.createElement("div");
    div.className = "kunde";
    div.textContent = `${kunde.name} — ${kunde.strasse}, ${kunde.ort}`;
    kundenFahrerListe.appendChild(div);
  });
}

// Menü für Fahrer anzeigen (aktueller Wochentag)
function zeigeMenuFahrer() {
  const heute = new Date();
  const options = { weekday: "long" };
  const tagName = heute.toLocaleDateString("de-DE", options);
  const lines = menuText.split("\n");
  let heuteMenu = "";
  for (let line of lines) {
    if (line.toLowerCase().startsWith(tagName.toLowerCase())) {
      heuteMenu = line.split(":")[1]?.trim() || "";
      break;
    }
  }
  menuFahrer.textContent = heuteMenu || "Für heute ist kein Menü eingetragen.";
}

// Karte initialisieren
function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 10,
    center: { lat: 53.5511, lng: 9.9937 }, // Hamburg als Standard
  });
  kunden.for
