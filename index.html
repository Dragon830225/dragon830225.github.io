<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Außer-Haus App</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onValue, set, push } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAJcjqAjlyrbiojweyXFOLMrelTsHSFog0",
      authDomain: "ausser-haus.firebaseapp.com",
      databaseURL: "https://ausser-haus-default-rtdb.firebaseio.com",
      projectId: "ausser-haus",
      storageBucket: "ausser-haus.appspot.com",
      messagingSenderId: "919348966579",
      appId: "1:919348966579:web:8cdbe342868eb6013eecc6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let isAdmin = false;

    function loadCustomers() {
      const list = document.getElementById("customers");
      list.innerHTML = "";
      onValue(ref(db, "kunden"), (snapshot) => {
        list.innerHTML = "";
        snapshot.forEach((child) => {
          const data = child.val();
          const li = document.createElement("li");
          li.textContent = `${data.name}, ${data.strasse}, ${data.ort}`;
          list.appendChild(li);
        });
      });
    }

    function loadMenu() {
      const menuList = document.getElementById("menu");
      const today = new Date().toLocaleDateString("de-DE", { weekday: "long" }).toLowerCase();
      onValue(ref(db, "menue"), (snapshot) => {
        menuList.innerHTML = "";
        const data = snapshot.val();
        if (!data) return;
        if (isAdmin) {
          for (const tag in data) {
            const li = document.createElement("li");
            li.textContent = `${tag}: ${data[tag]}`;
            menuList.appendChild(li);
          }
        } else {
          const li = document.createElement("li");
          li.textContent = `${today}: ${data[today] || "Kein Eintrag"}`;
          menuList.appendChild(li);
        }
      });
    }

    window.login = () => {
      const pw = prompt("Passwort:");
      if (pw === "1234") {
        isAdmin = true;
        document.getElementById("admin").style.display = "block";
        loadCustomers();
        loadMenu();
      } else {
        alert("Falsches Passwort!");
      }
    };

    window.addCustomer = () => {
      const name = prompt("Name?");
      const strasse = prompt("Straße?");
      const ort = prompt("Ort?");
      if (name && strasse && ort) {
        push(ref(db, "kunden"), { name, strasse, ort });
      }
    };

    window.setMenu = () => {
      const tag = prompt("Wochentag (z. B. montag)?").toLowerCase();
      const essen = prompt("Gericht für " + tag + "?");
      if (tag && essen) {
        set(ref(db, "menue/" + tag), essen);
      }
    };

    window.onload = () => {
      loadCustomers();
      loadMenu();
    };
  </script>
</head>
<body>
  <h1>🍽️ Außer-Haus Liefer-App</h1>
  <button onclick="login()">🔐 Admin-Login</button>
  <hr>

  <h2>Kundendaten</h2>
  <ul id="customers">Wird geladen...</ul>

  <h2>Menü</h2>
  <ul id="menu">Wird geladen...</ul>

  <div id="admin" style="display:none;">
    <hr>
    <button onclick="addCustomer()">➕ Kunden hinzufügen</button>
    <button onclick="setMenu()">📝 Menü ändern</button>
  </div>
</body>
</html>
